
@{
    ViewData["Title"] = "تقرير الغياب";

    DateTime firstMonthDay = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1);
    DateTime lastMonthDay = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1).AddMonths(1).AddDays(-1);
}

<div class="d-print-none">
    <form>
        <div class="row">
            <div class="form-group col-md-2">
                <label for="startDate" class="control-label"> من تاريخ :</label>
                <br />
                <kendo-datepicker name="startDate" id="startDate" value="firstMonthDay"
                     format="yyyy-MM-dd" min="new DateTime(2018,12,1)" max="lastMonthDay" 
                     class="form-control" data-toggle="tooltip" data-placement="bottom" title="عرض من تاريخ" />
            </div>
            <div class="form-group col-md-2">
                <label for="endDate" class="control-label"> إلى تاريخ :</label>
                <br />
                <kendo-datepicker name="endDate" id="endDate" value="lastMonthDay" 
                    format="yyyy-MM-dd" min="new DateTime(2018,12,1)" max="lastMonthDay"
                    class="form-control" data-toggle="tooltip" data-placement="bottom" title="عرض الى تاريخ" />
            </div>
            <div class="form-group col-md-3">
                <label for="employees" class="control-label"> الموظفين :</label>
                <br />
                @(Html.Kendo().MultiSelect()
                                        .Name("employees")
                                        .Placeholder("تحديد الموظفين ...")
                                        .HtmlAttributes(new { style = "100%" })
                                        .DataTextField("EmployeeId")
                                        .DataValueField("EmployeeId")
                                        .AutoClose(true)
                                        .AutoBind(false)
                                        .MinLength(3)
                                        .ItemTemplate("<span style=\"color:red\">#= EmployeeId #</span>&nbsp;-&nbsp; #= Name #")
                                .DataSource(source =>
                                {
                                    source.Read(read =>
                                    {
                                        read.Action("ShortEmployeesInfoByTextJson", "Employees");
                                    })
                                    .ServerFiltering(true);
                                })
                 )
            </div>
            <div class="form-group col-md-2" style="text-align:center">
                <label for="absentNote" class="control-label">الملاحظات</label>
                <div class="col" style="margin-top:5px">
                    <div class="form-check form-check-inline" data-toggle="tooltip" data-placement="bottom" title="عرض جميع أيام الغياب بدون استثناء">
                        <input style="margin-left:5px" class="form-check-input" type="radio" id="showNote" name="absentNotes" value="true" checked>
                        <label for="showNote" class="form-check-label"> عرض </label>
                    </div>
                    <div class="form-check form-check-inline" data-toggle="tooltip" data-placement="bottom" title="إخفاء أيام الغياب لمن لديه طلب إجازة او إنتداب">
                        <input style="margin-left:5px" class="form-check-input" type="radio" id="hideNote" name="absentNotes" value="false">
                        <label for="hideNote" class="form-check-label"> إخفاء </label>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-2" style="text-align:center;">
                <label for="reportType" class="control-label">نوع التقرير</label>
                <div class="col" style="margin-top:5px">
                    <div class="form-check form-check-inline" data-toggle="tooltip" data-placement="bottom" title="تقرير مختصر بالغياب للموظفين">
                        <input style="margin-left:5px" class="form-check-input" type="radio" id="summaryReport" name="reportType" value="true" checked>
                        <label for="summaryReport" class="form-check-label"> مختصر </label>
                    </div>
                    <div class="form-check form-check-inline" data-toggle="tooltip" data-placement="bottom" title="تقرير تفصيلي بالغياب للموظفين">
                        <input style="margin-left:5px" class="form-check-input" type="radio" id="detailsReport" name="reportType" value="false">
                        <label for="detailsReport" class="form-check-label"> تفصيلي </label>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-1">
                <label for="showAbsents" class="control-label">&nbsp;</label>
                <br />
                <button type="submit" id="showAbsents" class="btn btn-info btn-block"> عرض <i class="fas fa-search"></i> </button>
            </div>
        </div>
    </form>
</div>
<hr />

<div id="absentsData">
    <p id="report" class="lead" style="text-align:center;margin-top:150px;font-style:italic;color:gray"> .... تقرير الغياب .... </p>
</div>

@section scripts{
    <partial name="_ValidationScripts">
        <script>

            $(function () {

                $('[data-toggle="tooltip"]').tooltip()

              $('form').submit(function (e) {
                if ($(this).valid()) {

                    var options = {
                    url: "@Url.Action("AbsentsReport", "EmployeesDaysReports")",
                    type: "Post",
                    dataType: "html",
                        data: {
                              startDate: $("#startDate").val()
                            , endDate: $("#endDate").val()
                            , employeesIds: $("#employees").data("kendoMultiSelect").value()
                            , absentNotes: $("input[name='absentNotes']:checked").val()
                            , summaryReport: $("input[name='reportType']:checked").val()
                        },
                    success: function updateBalances(data) {
                        $("#absentsData").html(data);
                        $("#absentsData").fadeIn();
                    },
                 error: function () {
                     $("#absentsData").text("error");
                     $("#absentsData").fadeIn();
                        },
                 beforeSend: function () {
                     $("#absentsData").html("<div class='text-center'><div class='spinner-grow text-info' role='status'><span class='sr-only'> Loading...</span ></div></div>");
                        }
                };

                $.ajax(options);

                }

                e.preventDefault();
            });

            //toastr.clear();

        })

        </script>

}

